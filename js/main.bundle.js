(()=>{var e={533:()=>{const e={chrome:{step:.1,filter:"grayscale"},sepia:{step:.1,filter:"sepia"},marvin:{step:1,filter:"invert"},phobos:{step:.1,filter:"blur"},heat:{step:.1,filter:"brightness"}},t=document.querySelector(".effects__list"),r=document.querySelector(".img-upload__preview > img"),o=document.querySelector(".effect-level__slider"),c=document.querySelector(".effect-level__value"),n=document.querySelector(".img-upload__effect-level");let s="none",l=.1;window.noUiSlider.create(o,{range:{min:0,max:100},start:100,step:l,connect:"lower"}),t.addEventListener("change",(t=>{if(s=t.target.value,o.noUiSlider.updateOptions({start:100},!0),r.className="","none"===s)return r.style.filter="",void n.classList.add("hidden");n.classList.remove("hidden"),r.classList.add(`effects__preview--${s}`),l=e[s].step})),o.noUiSlider.on("update",((t,o,n)=>{if("none"===s)return void(r.style.filter="");let l;c.value=n[o],l="marvin"===s?`${e[s].filter}(${n[o]}%)`:"phobos"===s?`${e[s].filter}(${n[o]}px)`:`${e[s].filter}(${n[o]})`,r.style.filter=l}))},795:()=>{const e=document.querySelector(".scale__control--smaller"),t=document.querySelector(".scale__control--bigger"),r=document.querySelector(".scale__control--value"),o=document.querySelector(".img-upload__preview > img");e.addEventListener("click",(()=>{const e=r.value;let t,c;if("25%"!==e){switch(e){case"100%":t="75%",c="scale(0.75)";break;case"75%":t="50%",c="scale(0.5)";break;case"50%":t="25%",c="scale(0.25)"}r.value=t,o.style.transform=c}})),t.addEventListener("click",(()=>{const e=r.value;let t,c;if("100%"!==e){switch(e){case"25%":t="50%",c="scale(0.5)";break;case"50%":t="75%",c="scale(0.75)";break;case"75%":t="100%",c="scale(1)"}r.value=t,o.style.transform=c}}))},136:()=>{const e=document.querySelector(".text__hashtags"),t=document.querySelector(".text__description");t.addEventListener("input",(()=>{const e=t.value.length;e>140?t.setCustomValidity("Удалите лишние "+(e-MAX_NAME_LENGTH)+" симв."):t.setCustomValidity(""),t.reportValidity()})),e.addEventListener("input",(()=>{e.setCustomValidity("");let t=e.value.toLowerCase().trim();if(!t)return;let r=t.split(/\s+/);0!==r.length&&(r.some((e=>"#"!==e[0]))&&e.setCustomValidity("Хэш-тег начинается с символа #"),r.some((e=>"#"===e))&&e.setCustomValidity("Хэш-тег не может состоять только из решетки"),r.some((e=>e.indexOf("#",1)>=1))&&e.setCustomValidity("Хэш-теги разделяются пробелами"),r.some(((e,t,r)=>r.indexOf(e,t+1)>=t+1))&&e.setCustomValidity("Хэш-теги не должны повторяться"),r.some((e=>e.length>20))&&e.setCustomValidity("Максимальная длина хэш-тега 20 символов, включая решетку"),r.length>5&&e.setCustomValidity("Максимум 5 хэш-тегов"))}))}},t={};function r(o){var c=t[o];if(void 0!==c)return c.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=e=>"Enter"===e.key,o=document.querySelector(".big-picture"),c=o.querySelector(".social__comments"),n=o.querySelector(".big-picture__cancel"),s=o.querySelector(".comments-loader"),l=o.querySelector(".comments-count");let a,i=5;s.addEventListener("click",(()=>{d(a)}));const d=e=>{if(i+5<e.comments.length)return u(e.comments,i,i+5),i+=5,void(l.textContent=i);u(e.comments,i,i+(e.comments.length-i)),i+=e.comments.length-i,l.textContent=i,o.querySelector(".comments-loader").classList.add("hidden")},u=(e,t,r)=>{for(let o=t;o<r;o++)m(e[o])},m=e=>{const t=document.querySelector("#comment").content.querySelector(".social__comment").cloneNode(!0),r=t.querySelector(".social__picture"),o=t.querySelector(".social__text");r.src=e.avatar,r.alt=e.name,o.textContent=e.message,c.appendChild(t)},y=()=>{o.classList.add("hidden"),(()=>{const e=document.querySelectorAll(".social__comment");e&&e.forEach((e=>{e.remove()}))})(),s.removeEventListener("click",(()=>{d(a)})),i=5,o.querySelector(".comments-loader").classList.contains("hidden")&&o.querySelector(".comments-loader").classList.remove("hidden"),document.removeEventListener("keydown",v),document.querySelector("body").classList.remove("modal-open")},v=t=>{e(t)&&(t.preventDefault(),y())};n.addEventListener("click",y),n.addEventListener("keydown",(e=>{t(e)&&y()}));const p=document.querySelector(".pictures"),f=document.querySelector("#picture").content.querySelector(".picture"),S=document.querySelector(".error-message"),g=_.debounce((e=>{for(let t=0;t<e.length;t++)h(e[t])}),500),h=e=>{const t=f.cloneNode(!0),r=t.querySelector(".picture__img"),c=t.querySelector(".picture__comments"),n=t.querySelector(".picture__likes");r.src=e.url,c.textContent=e.comments.length,n.textContent=e.likes,t.addEventListener("click",(t=>{t.preventDefault(),(e=>{const t=o.querySelector(".big-picture__img").querySelector("img"),r=o.querySelector(".likes-count"),c=o.querySelector(".comments-count-max"),n=o.querySelector(".social__caption");a=e,t.src=e.url,r.textContent=e.likes,n.textContent=e.description,e.comments.length<=5&&(o.querySelector(".comments-loader").classList.add("hidden"),i=e.comments.length),u(e.comments,0,i),l.textContent=i,c.textContent=e.comments.length,o.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",v)})(e)})),p.appendChild(t)},q=()=>{S.classList.remove("hidden"),setTimeout(L,5e3)},L=()=>{S.classList.add("hidden")};let k;const E=document.querySelector("main"),w=document.querySelector("#error").content.querySelector(".error"),b=document.createDocumentFragment(),C=document.querySelector("#success").content.querySelector(".success"),x=document.createDocumentFragment(),V=e=>{document.querySelector(e).remove(),document.removeEventListener("keydown",$)},$=t=>{e(t)&&V()},D=["gif","jpg","jpeg","png"],N=document.querySelector("#upload-file"),A=document.querySelector(".img-upload__overlay"),M=document.querySelector("#upload-cancel"),j=document.querySelector(".text__hashtags"),F=document.querySelector(".text__description"),O=document.querySelector(".img-upload__preview > img"),U=document.querySelector(".scale__control--value"),T=A.querySelector(".img-upload__effect-level"),R=document.querySelector(".img-upload__form"),G=document.querySelectorAll(".effects__preview");N.addEventListener("input",(()=>{N.value.length>0&&(A.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open")),document.addEventListener("keydown",P)})),N.addEventListener("change",(()=>{const e=N.files[0],t=e.name.toLowerCase();if(D.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{O.src=t.result,G.forEach((e=>{e.style.backgroundImage=`url(${t.result})`}))})),t.readAsDataURL(e)}}));const H=()=>{A.classList.add("hidden"),I(),document.removeEventListener("keydown",P),document.querySelector("body").classList.remove("modal-open")},I=()=>{O.style.transform="scale(1)",O.style.filter="",O.className="",U.value="100%",T.classList.add("hidden")},P=t=>{e(t)&&j!==document.activeElement&&F!==document.activeElement&&(t.preventDefault(),H())};M.addEventListener("click",(()=>{H()})),M.addEventListener("keydown",(e=>{t(e)&&H()})),r(795),r(533),r(136);const W=document.querySelector(".img-filters"),X=W.querySelector(".img-filters__form");let z="filter-default",B=k;X.addEventListener("click",(e=>{if(e.target.id!==z||"filter-random"===e.target.id){switch(W.querySelector(`#${z}`).classList.remove("img-filters__button--active"),z=e.target.id,W.querySelector(`#${z}`).classList.add("img-filters__button--active"),z){case"filter-default":B=k.slice();break;case"filter-random":K();break;case"filter-discussed":Q()}J(),g(B)}}));const J=()=>{const e=document.querySelectorAll(".picture");e&&e.forEach((e=>{e.remove()}))},K=()=>{B=[];for(let r=0;r<10;r++)B.push(k[(e=0,t=k.length-1,e<0||t<0?-1:(t<=e&&([e,t]=[t,e]),e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e))]);var e,t},Q=()=>{B=k.slice().sort(((e,t)=>t.comments.length-e.comments.length))};(async()=>{try{await(async(e,t)=>{try{const e=await fetch("https://23.javascript.pages.academy/kekstagram/data"),t=await e.json();(e=>{g(e)})(t),k=t}catch(e){q()}})(),W.classList.remove("img-filters--inactive")}catch(e){q()}})(),R.addEventListener("submit",(e=>{e.preventDefault(),(async(e,r,o)=>{try{(await fetch("https://23.javascript.pages.academy/kekstagram",{method:"POST",body:o})).ok?(H(),(()=>{const e=C.cloneNode(!0),r=e.querySelector(".success__button");document.addEventListener("click",(t=>{e.querySelector(".success__inner").contains(t.target)||V(".success")})),r.addEventListener("click",(()=>{V(".success")})),r.addEventListener("keydown",(e=>{t(e)&&V(".success")})),document.addEventListener("keydown",$),x.appendChild(e),E.appendChild(x)})()):r()}catch(e){r()}})(0,(()=>(H(),void(()=>{const e=w.cloneNode(!0),r=e.querySelector(".error__button");document.addEventListener("click",(t=>{e.querySelector(".error__inner").contains(t.target)||V(".error")})),r.addEventListener("click",(()=>{V(".error")})),r.addEventListener("keydown",(e=>{t(e)&&V(".error")})),document.addEventListener("keydown",$),b.appendChild(e),E.appendChild(b)})())),new FormData(e.target))}))})()})();
//# sourceMappingURL=main.bundle.js.map